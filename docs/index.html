<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Newsletter — Echome Energies</title>
  <meta name="description" content="Newsletter Echome Energies : l’essentiel du photovoltaïque en 3 minutes — tarifs & primes CRE, actus scorées, innovation, cas client, conseil." />
  <meta name="color-scheme" content="light" />
  <meta name="theme-color" content="#37C3AF" />

  <!-- Favicon -->
  <link rel="icon" href="Echom-Energie_logo fond noir.jpg" type="image/jpeg">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;800&family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --ink:#101316; --sub:#5e6b78; --line:#e6edf2; --bg:#ffffff; --muted:#f7fafb;
      --brand:#37C3AF; --brand-ink:#0d3e38; --dark:#0f1113;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);
      font:15.8px/1.7 Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,"Noto Sans",sans-serif;
      -webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;}
    a{color:var(--brand-ink);text-decoration:underline}
    a:hover{text-decoration:none}
    .wrap{max-width:1140px;margin:auto;padding:0 18px 44px}

    /* HERO – clair premium */
    .hero{
      background:
        radial-gradient(900px 420px at 10% 10%, rgba(55,195,175,0.18), rgba(55,195,175,0) 60%),
        linear-gradient(180deg, #f9fdfc 0%, #f4fbf9 100%);
      color:var(--ink);
      position:relative;
      overflow:hidden;
    }
    .hero .inner{max-width:1140px;margin:0 auto;padding:28px 18px 36px;display:grid;gap:10px}
    .brand{display:flex;align-items:center;gap:16px}
    .brand-logo{width:160px;height:auto;display:block;border-radius:10px;box-shadow:0 6px 16px rgba(16,19,22,.06)}
    h1{margin:6px 0 0;font:800 clamp(26px,3vw,38px)/1.15 Montserrat,Inter;color:var(--ink)}
    .hero .lede{margin:6px 0 0;color:#306a62}
    .hero .meta{margin:2px 0 0;color:#6b7a86;font-size:13.5px}
    .hero .tags{margin-top:12px;display:flex;gap:8px;flex-wrap:wrap}
    .tag{padding:6px 10px;border:1px solid #d7ece8;background:#eef8f6;color:#0d3e38;
      border-radius:999px;font-size:12.5px;font-weight:600}
    .hero::after{
      content:"";position:absolute;left:0;right:0;bottom:-1px;height:36px;
      background:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="36" viewBox="0 0 1200 36" preserveAspectRatio="none"><path d="M0,12 C300,48 900,-24 1200,12 L1200,36 L0,36 Z" fill="%23ffffff"/></svg>') center/cover no-repeat;
    }

    /* TOC */
    nav.toc{border-bottom:1px solid var(--line);background:var(--muted)}
    nav.toc .inner{max-width:1140px;margin:0 auto;display:flex;gap:10px;flex-wrap:wrap;padding:8px 18px}
    nav.toc a{padding:7px 12px;border:1px solid var(--line);border-radius:10px;background:#fff;color:var(--brand-ink);text-decoration:none}
    nav.toc a:hover{background:#eef7f5}

    /* SECTIONS */
    section{padding:24px 0;border-bottom:1px solid var(--line)}
    section:last-of-type{border-bottom:none}
    h2{margin:0 0 12px;font:800 20px/1.3 Montserrat,Inter}
    h3{margin:0 0 8px;font:700 16.5px/1.35 Montserrat,Inter}
    .sub{margin:0 0 12px;color:var(--sub)}
    .note{border-left:4px solid var(--brand);background:#fff;border:1px solid var(--line);padding:12px;border-radius:10px}

    /* GRID & CARDS */
    .cols{display:grid;gap:18px}
    @media(min-width:900px){ .cols{grid-template-columns:1fr 1fr} }
    .grid-3{display:grid;gap:16px}
    @media(min-width:980px){ .grid-3{grid-template-columns:1fr 1fr 1fr} }
    .card{background:#fff;border:1px solid var(--line);border-radius:12px;overflow:hidden}
    .card header{display:flex;align-items:center;justify-content:space-between;gap:8px;
      padding:10px 12px;border-bottom:1px solid var(--line);margin:0;background:#fbfdfe}
    .badge{padding:4px 8px;border:1px solid var(--line);border-radius:999px;font-size:12px;background:#f8fafb;color:#2a3c41}
    .table-wrap{padding:10px;overflow:auto}
    table{width:100%;border-collapse:collapse;font-size:14px}
    th,td{border:1px solid #e5eaee;padding:8px;text-align:left}
    th{background:#f5f7f8}
    .kpi{display:flex;gap:10px;flex-wrap:wrap;margin:6px 0 0}
    .kpi .pill{background:#eef7f5;border:1px solid var(--line);border-radius:999px;padding:6px 10px;font-weight:600;color:#0d3e38}

    /* NEWS CARDS */
    .news{display:grid;gap:14px}
    .news .card{display:flex;flex-direction:column}
    .news .content{padding:12px}
    .source{font-size:12.5px;color:#6b7a86;margin:0 0 4px}
    .title{margin:0 0 6px;font-weight:800}
    .title a{text-decoration:none}
    .title a:hover{text-decoration:underline}
    .meta-row{font-size:12.5px;color:#6b7a86}

    /* FOOTER */
    footer.site{margin-top:26px;padding:16px 0 28px;color:#6b7a86;font-size:13px}
    .cta{margin-top:12px;display:flex;flex-wrap:wrap;gap:8px}
    .btn{padding:10px 14px;border-radius:10px;text-decoration:none;font-weight:700}
    .btn.primary{background:var(--brand);color:#08302c}
    .btn.ghost{border:1px solid var(--line);background:#fff;color:#0d3e38}
  </style>
</head>
<body>

<!-- HERO -->
<section class="hero">
  <div class="inner">
    <div class="brand">
      <img class="brand-logo" src="Echom-Energie_logo fond noir.jpg" alt="Echome Energies — logo">
      <div>
        <h1>Newsletter — Echome Energies</h1>
        <p class="lede">Produire, consommer, recharger — en toute confiance.</p>
        <p class="meta">Édition <time id="edition-date"></time> · Sources : CRE · Photovoltaïque.info · Veille sectorielle</p>
      </div>
    </div>
    <div class="tags">
      <span class="tag">Tarifs & Primes CRE</span>
      <span class="tag">Actualités photovoltaïque</span>
      <span class="tag">Innovation & cas clients</span>
    </div>
  </div>
</section>

<!-- TOC -->
<nav class="toc"><div class="inner">
  <a href="#essentiel">L’essentiel</a>
  <a href="#tarifs-prime">Tarifs & Prime</a>
  <a href="#actus">Actus PV</a>
  <a href="#innovation">Innovation</a>
  <a href="#cas-client">Cas client</a>
  <a href="#conseil">Conseil</a>
  <a href="#sources">Sources</a>
  <a href="#contact">Contact</a>
</div></nav>

<div class="wrap">

  <section id="essentiel"><h2>L’essentiel</h2><ul class="sub" id="topline-bullets"></ul></section>

  <section id="tarifs-prime"><h2>Tarifs d’achat (EDF OA) et prime à l’autoconsommation — mise à jour CRE</h2>
    <div class="cols">
      <article class="card"><header><h3>Tarifs OA</h3><span class="badge">MàJ <time id="maj-tarifs"></time></span></header><div class="table-wrap"><table><thead><tr><th>Puissance</th><th>Tarif</th><th>Exemple</th></tr></thead><tbody id="tarifs-body"></tbody></table></div></article>
      <article class="card"><header><h3>Prime autoconsommation</h3><span class="badge">MàJ <time id="maj-prime"></time></span></header><div class="table-wrap"><table><thead><tr><th>Puissance</th><th>Prime</th></tr></thead><tbody id="primes-body"></tbody></table></div></article>
    </div>
    <div class="note" id="delta-cre"><strong>Ce que ça change :</strong></div>
  </section>

<section id="editor-shortlist">
  <h2 style="display:flex;align-items:center;gap:8px">
    Shortlist mensuelle (proposition)
    <span class="badge">Step 2 — Pré-sélection</span>
  </h2>
  <p class="sub">Proposition automatique issue des 20 newsletters suivies. Valide 1 sujet “Zoom Actu” et 1 sujet “Tendance marché”.</p>

  <div class="cols" id="shortlist-cards"></div>

  <div class="note" id="synthese-tendances" style="margin-top:12px">
    <strong>Synthèse des tendances :</strong>
    <ul id="trend-bullets" class="sub" style="margin:8px 0 0"></ul>
  </div>

  <div class="cols" style="margin-top:12px">
    <div class="note" id="zoom-proposal">
      <h3>Suggestion Zoom Actu</h3>
      <p class="sub" id="zoom-expl"></p>
    </div>
    <div class="note" id="trend-proposal">
      <h3>Suggestion Tendance marché</h3>
      <p class="sub" id="trend-expl"></p>
    </div>
  </div>
</section>
  
  <section id="actus"><h2>Actualités photovoltaïque</h2><div class="grid-3 news" id="news-cards"></div></section>

  <section id="innovation"><h2>Innovation — Solutions MyLight150</h2><div class="cols">
    <div class="note"><h3>MySmartBattery</h3><p>Batterie virtuelle : jusqu’à 100 % d’autoconsommation, -80 % facture élec. Pilotage météo (Greenplay).</p></div>
    <div class="note"><h3>MySmartHeatPump</h3><p>-30 % dépenses énergétiques PAC, pilotage connecté, confort inchangé.</p></div>
    <div class="note"><h3>MySmartCharger</h3><p>Borne solaire connectée (3 modes : solaire, rapide, HC). -40 % coûts vs. bornes concurrentes.</p></div>
  </div></section>

  <section id="cas-client"><h2>Cas client — Maison 6 kWc + MySmartBattery</h2><ul class="sub"><li>Production : 6 600 kWh/an</li><li>Autoconsommation : ~100 % grâce batterie</li><li>Économie annuelle : 2 176 €</li></ul></section>

  <section id="conseil"><h2>Conseil — Autoconsommation collective</h2><div class="cols">
    <div class="note"><h3>Rappel</h3><p>Article L315-2 du code de l’énergie : production partagée via une PMO, périmètre ≤ 2 km.</p></div>
    <div class="note"><h3>Avantages</h3><ul class="sub"><li>Valorisation locale</li><li>Partage équitable</li><li>Dynamique citoyenne</li></ul></div>
  </div></section>

  <section id="sources"><h2>Sources officielles</h2><ul class="sub"><li>CRE — arrêtés & appels d’offres</li><li><a href="https://www.photovoltaique.info/fr/tarifs-dachat-et-autoconsommation/">Photovoltaïque.info (INES/CEA)</a></li></ul></section>

  <section id="contact"><h2>Contact</h2><p class="sub">Echome Energies — Saint-Quentin-sur-Isère</p><p class="sub">☎ <a href="tel:+33476373462">04 76 37 34 62</a> · ✉ <a href="mailto:contact@echome-energies.fr">contact@echome-energies.fr</a></p></section>

  <footer class="site"><div class="cta"><a class="btn primary" href="#contact">Parlons de votre projet</a><a class="btn ghost" href="#tarifs-prime">Voir tarifs & primes</a></div><p>© <span id="year"></span> Echome Energies</p></footer>

</div>

<script>
  const now=new Date(),fr=now.toLocaleDateString('fr-FR');
  (d=>{d('edition-date').textContent=fr;d('maj-tarifs').textContent=fr;d('maj-prime').textContent=fr;d('year').textContent=now.getFullYear();})(id=>document.getElementById(id));
  const safeLoad=async u=>{try{const r=await fetch(u,{cache:'no-store'});if(!r.ok)throw 0;return await r.json()}catch{return null}};
  (async()=>{
    const tarifs=await safeLoad('../data/tarifs.json')||await safeLoad('data/tarifs.json');
    if(tarifs)document.getElementById('tarifs-body').innerHTML=tarifs.map(t=>`<tr><td>${t.puissance}</td><td>${t.tarif}</td><td>${t.exemple}</td></tr>`).join('');
    const primes=await safeLoad('../data/primes.json')||await safeLoad('data/primes.json');
    if(primes)document.getElementById('primes-body').innerHTML=primes.map(p=>`<tr><td>${p.puissance}</td><td>${p.prime}</td></tr>`).join('');
  })();
  (async()=>{
    const feeds=await safeLoad('../reports/feeds.json')||await safeLoad('reports/feeds.json');
    if(!feeds||!feeds.items)return;
    const items=feeds.items.slice(0,3);
    document.getElementById('topline-bullets').innerHTML=items.map(it=>`<li>${it.title}</li>`).join('');
    document.getElementById('news-cards').innerHTML=items.map(it=>`
      <article class="card"><div class="content">
      <p class="source"><span class="badge">Actu</span> ${it.source_name||''}</p>
      <h3 class="title"><a href="${it.url}" target="_blank">${it.title}</a></h3>
      <p class="meta-row">${it.date?new Date(it.date).toLocaleDateString('fr-FR'):'Sélection'}</p>
      </div></article>`).join('');
  })();
</script>

<script>
(async () => {
  // --- helpers ---
  const tryJson = async (u)=>{ try{const r=await fetch(u,{cache:'no-store'}); if(!r.ok) throw 0; return await r.json();}catch{return null;} };
  const fmt = (d)=> d ? new Date(d).toLocaleDateString('fr-FR') : '—';
  const THEMES = [
    {key:'Prix',           rx:/(prix|price|€/i), weight:2},
    {key:'Régulation',     rx:/(CRE|arrêté|décret|appel d’offres|AO|régulation|tarif|prime)/i, weight:3},
    {key:'Stockage',       rx:/(batterie|storage|V2H|V2G|Powerwall|virtuel|MySmartBattery|bms)/i, weight:2},
    {key:'AgriPV',         rx:/(agrivolta|agri-photovolta|serre|élevage)/i, weight:2},
    {key:'BIPV',           rx:/(BIPV|intégr(é|ee)|tuiles? solaires?|façade)/i, weight:1},
    {key:'Tendance',       rx:/(marché|tendance|record|gigafactory|investissement|prix du silicium)/i, weight:1},
  ];

  // --- charge feeds ---
  const feeds = await tryJson('../reports/feeds.json') || await tryJson('reports/feeds.json');
  if(!feeds || !Array.isArray(feeds.items) || !feeds.items.length){
    document.getElementById('shortlist-cards').innerHTML = '<p class="sub">Aucune donnée dispo (feeds.json introuvable). Le module reste en veille.</p>';
    return;
  }

  // --- scoring ---
  const scoreOne = (it) => {
    const text = [it.title, it.summary, it.source_name].filter(Boolean).join(' ');
    let label = 'Tendance', score = 0;
    for(const th of THEMES){
      if(th.rx.test(text)){ score += th.weight; label = th.key; }
    }
    const ageDays = it.date ? (Date.now()-new Date(it.date).getTime())/86400000 : 999;
    if (ageDays < 7) score += 3; else if (ageDays < 14) score += 2; else if (ageDays < 31) score += 1;
    // bonus si plusieurs occurrences du thème clé dans le titre
    const title = (it.title||'');
    if (label!=='Tendance' && (title.match(THEMES.find(t=>t.key===label)?.rx)||[]).length>1) score += 1;
    return {...it, score, label, ageDays};
  };

  // --- tri + diversité de sources ---
  const all = feeds.items.map(scoreOne).sort((a,b)=> b.score - a.score);
  const shortlist = [];
  const seenSrc = new Set();
  for(const it of all){
    const src = it.source_name || it.source || 'source';
    if(seenSrc.has(src)) continue;
    shortlist.push(it);
    seenSrc.add(src);
    if (shortlist.length >= 5) break;
  }

  // --- rendu cartes shortlist ---
  const htmlCard = (it) => `
    <article class="card">
      <header>
        <span class="badge">${it.label}</span>
        <span class="sub" style="font-size:12px">${it.source_name||'Source'}</span>
      </header>
      <div class="content" style="padding:12px">
        <h3 class="title" style="margin:0 0 6px"><a target="_blank" rel="noopener" href="${it.url||'#'}">${(it.title||'(sans titre)').replace(/</g,'&lt;')}</a></h3>
        <p class="meta-row">Publié le ${fmt(it.date)} · Score ${it.score}</p>
      </div>
    </article>`;
  document.getElementById('shortlist-cards').innerHTML = shortlist.map(htmlCard).join('');

  // --- synthèse tendances (top 3 labels) ---
  const counts = shortlist.reduce((acc,it)=> (acc[it.label]=(acc[it.label]||0)+1, acc), {});
  const topLabels = Object.entries(counts).sort((a,b)=> b[1]-a[1]).slice(0,3).map(([k,v])=>({k,v}));
  const bulletOf = (k)=>({
    'Prix': 'Prix modules : mouvement notable (opportunité CAPEX/ROI).',
    'Régulation': 'Réglementaire : fenêtre CRE/arrêtés à surveiller.',
    'Stockage': 'Stockage résidentiel/PME en montée (couplage PV).',
    'AgriPV': 'AgriPV : projets et cadre en évolution locale.',
    'BIPV': 'BIPV : intégration architecturale en progrès.',
    'Tendance': 'Marché PV : dynamique et volumes en hausse.'
  }[k] || 'Signal marché pertinent.');
  document.getElementById('trend-bullets').innerHTML = topLabels.map(({k})=> `<li>${bulletOf(k)}</li>`).join('');

  // --- propositions Zoom Actu & Tendance marché ---
  const pick = (labelWanted) => shortlist.find(it=>it.label===labelWanted) || shortlist[0];
  const zoom = pick('Régulation') || pick('Prix');   // si possible on met la régulation en Zoom
  const trend = pick('Prix') || pick('Tendance');    // marché/prix en “Tendance”

  const explain = (it) => it ? `${it.label} — <a href="${it.url||'#'}" target="_blank" rel="noopener">${(it.title||'Actu sélectionnée').replace(/</g,'&lt;')}</a> · ${fmt(it.date)} · ${it.source_name||'Source'}` : '—';
  document.getElementById('zoom-expl').innerHTML = explain(zoom);
  document.getElementById('trend-expl').innerHTML = explain(trend);

  // --- bonus : alimente "L’essentiel" si vide (3 bullets dérivés) ---
  const topline = [
    zoom?.label==='Régulation' ? 'Réglementaire : période/arrêté CRE à suivre.' : null,
    trend?.label==='Prix' ? 'Prix modules : dynamique et écarts par techno.' : null,
    shortlist.some(i=>i.label==='Stockage') ? 'Stockage : cas d’usage résidentiel/PME en hausse.' : null
  ].filter(Boolean).slice(0,3);
  if (topline.length && document.getElementById('topline-bullets') && !document.getElementById('topline-bullets').children.length){
    document.getElementById('topline-bullets').innerHTML = topline.map(t=>`<li>${t}</li>`).join('');
  }
})();
</script>

  
</body>
</html>
