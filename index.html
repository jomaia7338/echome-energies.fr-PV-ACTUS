<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<meta name="theme-color" content="#1C1C1C">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<title>Echome Prospection PV — v2 Offline Enrichie</title>
<link rel="icon" href="data:,">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<style>
:root{
  --brand:#37C3AF; --brand-dark:#2ea898; --carbon:#1C1C1C;
  --bg:#f8fafc; --card:#fff; --text:#0f172a; --muted:#64748b;
  --r:14px; --shadow:0 6px 18px rgba(16,24,40,.08);
  --safe-top: env(safe-area-inset-top, 0px);
  --safe-bot: env(safe-area-inset-bottom, 0px);
  --header-total:84px;
}
@supports(padding: constant(safe-area-inset-top)) {
  :root{ --safe-top: constant(safe-area-inset-top); --safe-bot: constant(safe-area-inset-bottom); }
}
*{box-sizing:border-box} html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial}

/* --- HEADER FIX --- */
header{
  position:fixed;inset:0 0 auto 0;z-index:60;
  background:var(--carbon);color:#fff;
  padding-top:calc(var(--safe-top) + 12px);
  box-shadow:0 2px 12px rgba(0,0,0,.15);
}
.header-inner{
  max-width:980px;margin:0 auto;
  display:flex;align-items:center;justify-content:space-between;gap:12px;
  padding:10px 16px 12px;
  min-height:60px;
}
main{padding-top:var(--header-total);padding-bottom:calc(16px + var(--safe-bot));}

/* --- STRUCTURE ET STYLE --- */
.brand{display:flex;align-items:center;gap:10px}
.brand img{width:32px;height:32px;object-fit:contain;border-radius:8px;background:#000}
.brand .t .title{font-weight:800;font-size:16px}
.brand .t .sub{font-size:12px;opacity:.8}
.actions{display:flex;gap:8px;flex-wrap:wrap}
.actions .btn{background:#202324;border:1px solid #2f3336;color:#cbd5e1;border-radius:999px;padding:6px 10px;font-size:12px;cursor:pointer}
.actions .btn.primary{background:var(--brand);border-color:var(--brand);color:#0b1220}

.container{max-width:980px;margin:0 auto;padding:16px}
.card{background:var(--card);border-radius:var(--r);box-shadow:var(--shadow);padding:16px;margin:16px 0}
.row{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
.input{width:100%;padding:10px 12px;border:1px solid #e2e8f0;border-radius:12px;background:#fff;font-size:16px}
select.input{padding-right:28px} textarea.input{min-height:90px;resize:vertical}
.btn{border-radius:12px;padding:10px 14px;border:1px solid #e2e8f0;background:#fff;font-size:14px;cursor:pointer}
.btn.primary{background:var(--brand);color:#fff;border-color:var(--brand)} .btn.primary:hover{background:var(--brand-dark)}
.toolbar{display:flex;gap:8px;flex-wrap:wrap}
.tag{background:#f1f5f9;border:1px solid #e2e8f0;border-radius:999px;padding:6px 10px;font-size:12px}
.badge{background:#eef2ff;border:1px solid #c7d2fe;border-radius:999px;padding:4px 8px;font-size:12px}
.muted{color:var(--muted);font-size:12px}
.toast{position:fixed;left:50%;transform:translateX(-50%);bottom:calc(16px + var(--safe-bot));background:#0f172a;color:#fff;padding:8px 12px;border-radius:10px;font-size:13px;box-shadow:var(--shadow);z-index:999}
.tabs{display:flex;gap:8px;flex-wrap:wrap}
.tab{border:1px solid #e2e8f0;background:#fff;border-radius:999px;padding:6px 10px;font-size:12px;cursor:pointer}
.tab.active{background:var(--brand);color:#0b1220;border-color:var(--brand)}
.list{display:grid;grid-template-columns:1fr;gap:10px}
.item{display:flex;gap:10px;align-items:center;padding:12px;border:1px solid #e2e8f0;border-radius:12px;background:#fff}
.item .avatar{width:40px;height:40px;border-radius:10px;background:#e2e8f0;display:flex;align-items:center;justify-content:center;font-weight:700}
.item .meta{flex:1;min-width:0}
.item .meta .name{font-weight:700}
.item .meta .line{font-size:12px;color:var(--muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.float-add{position:fixed;right:16px;bottom:calc(16px + var(--safe-bot));z-index:55;background:var(--brand);color:#fff;border:none;border-radius:999px;width:56px;height:56px;display:flex;align-items:center;justify-content:center;font-size:28px;box-shadow:0 10px 20px rgba(55,195,175,.35)}
.overlay{position:fixed;inset:0;background:rgba(15,23,42,.6);display:none;align-items:flex-end;z-index:70}
.sheet{background:#fff;border-top-left-radius:16px;border-top-right-radius:16px;max-height:85vh;overflow:auto;width:100%;padding:12px}
.section-title{font-weight:800;margin:6px 0 8px}
.hidden{display:none}
hr{border:none;border-top:1px solid #e2e8f0;margin:12px 0}
.kpis{display:flex;gap:8px;flex-wrap:wrap}
.kpi{background:#f8fffd;border:1px solid #c7f4ea;border-radius:10px;padding:6px 10px;font-size:12px}
.kpi.warn{background:#fff7ed;border-color:#fed7aa}
#mapWrap{position:fixed;inset:0;display:none;z-index:80;background:#0b1220cc}
#mapPanel{position:absolute;left:0;right:0;bottom:0;top:0;margin:0}
#map{height:100%;width:100%}
.mapbar{position:absolute;left:0;right:0;top:0;display:flex;gap:8px;padding:8px;background:rgba(28,28,28,.85);color:#fff;align-items:center}
.mapbar .btn{background:#202324;border:1px solid #2f3336;color:#fff}
.mapbar .btn.primary{background:var(--brand);border-color:var(--brand);color:#0b1220}
.thumb{width:64px;height:64px;border-radius:10px;border:1px solid #e2e8f0;object-fit:cover}
.gallery{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px}
</style>

<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body>

<header>
  <div class="header-inner">
    <div class="brand">
      <img src="logo-echome-energies.png" alt="Echome">
      <div class="t">
        <div class="title">Echome Prospection PV</div>
        <div class="sub">v2 Offline · R1+R2 · Relances · Export XLSX</div>
      </div>
    </div>
    <div class="actions">
      <button class="btn" id="btnImport">Importer</button>
      <input id="fileInput" type="file" accept=".xlsx,.csv" style="display:none">
      <button class="btn" id="btnExport">Exporter (XLSX)</button>
      <button class="btn primary" id="btnAddTop">+ Ajouter</button>
    </div>
  </div>
</header>

<main>
  <div class="container">
    <!-- le reste de ton application ici : liste, filtres, overlay, fiche R1/R2 -->
    <!-- (inchangé, code complet précédent repris tel quel) -->
  </div>
</main>

<!-- script pour corriger la hauteur du header -->
<script>
(function fixHeaderOffset(){
  const set = () => {
    const h = document.querySelector('header');
    if(!h) return;
    const total = Math.ceil(h.getBoundingClientRect().height);
    document.documentElement.style.setProperty('--header-total', (total + 6) + 'px');
  };
  set();
  window.addEventListener('resize', set, {passive:true});
  window.addEventListener('orientationchange', set, {passive:true});
  setTimeout(set, 250);
})();
</script>

<!-- ton bloc JS principal complet ici (inchangé) -->
<!-- ... -->
</body>
</html>
